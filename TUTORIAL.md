# Qlib 可视化工具使用教程 (最终版)

欢迎使用 Qlib 可视化工具！本工具旨在帮助不熟悉编程的用户也能利用 Qlib 强大的量化金融能力。

## 1. 安装与环境配置

在开始之前，请确保您的电脑已经安装了 Python (建议版本 3.9, 3.10, 3.11)。

**步骤一：下载项目文件**

请将我们创建的所有应用文件下载到您电脑的同一个文件夹中：
- `app.py` (应用主程序)
- `qlib_utils.py` (核心功能库)
- `requirements.txt` (依赖列表)
- `TUTORIAL.md` (本教程)
- `QLIB_INTRO.md` (概念入门)

**步骤二：下载 Qlib 官方脚本 (非常重要！)**

本工具需要依赖 `qlib` 官方提供的数据处理脚本。
1.  请访问 Qlib 的 GitHub 仓库地址：[https://github.com/microsoft/qlib](https://github.com/microsoft/qlib)
2.  找到并点击绿色的 `<> Code` 按钮，然后选择 `Download ZIP` 将整个项目下载下来。
3.  解压后，找到里面的 `scripts` 文件夹。
4.  将这个**完整的 `scripts` 文件夹**复制到与 `app.py` 相同的目录下。

最终您的文件夹结构应该如下所示：
```
your_project_folder/
├── app.py
├── qlib_utils.py
├── requirements.txt
├── TUTORIAL.md
├── QLIB_INTRO.md
└── scripts/      <-- 完整的 scripts 文件夹
    ├── check_data_health.py
    └── data_collector/
        └── ...
```

**步骤三：安装依赖库**

打开您电脑的终端（在 Windows 上是 `Command Prompt` 或 `PowerShell`，在 macOS 或 Linux 上是 `Terminal`），进入您的项目文件夹，然后运行以下命令：

```bash
pip install -r requirements.txt
```

## 2. 运行本工具

所有依赖都安装好后，在同一个终端窗口和文件夹下，运行以下命令：

```bash
streamlit run app.py
```

运行后，您的浏览器会自动打开一个新的网页，地址通常是 `http://localhost:8501`。这个网页就是我们的可视化工具界面！

## 3. 功能页面详解

应用界面上方是导航栏，您可以在四个功能页面之间切换。

### 页面一：数据管理 (重要！第一步)

这是您需要使用的第一个页面，所有后续操作都依赖于这里下载的数据。

- **1. 全量下载 (首次使用)**：如果您是第一次使用，或数据不完整，请点此按钮。这将从头下载所有A股日线数据，过程非常耗时（可能超过30分钟）。
- **2. 增量更新 (日常使用)**：如果已有全量数据，可在此处选择日期范围，更新最新的日线数据。
- **3. 数据健康度检查**：下载或更新数据后，点击此按钮，程序会检查本地数据的完整性和质量，并将报告显示在日志区。
- **4. 设置自动化每日更新 (可选)**：为高级用户提供的在自有服务器上设置自动化更新的说明。

### 页面二：模型训练

当数据准备好后，您就可以训练自己的AI模型了。

- **1. 训练模式与模型配置**
  - **选择训练模式**:
    - `从零开始新训练`: 创建一个全新的模型。
    - `在旧模型上继续训练 (Finetune)`: 加载一个之前训练过的模型，并在它的基础上进行增量训练，适合微调。
  - **选择模型和因子**: 您可以选择不同的模型（如`LightGBM`, `XGBoost`, `CatBoost`）和不同的因子集（如`Alpha158`, `Alpha360`）的组合。
    - **ALSTM模型警告**: 当选择`ALSTM`时，会出现警告，提示您这是一个深度学习模型，训练非常耗时且消耗资源。
  - **选择股票池**: 可以选择在`沪深300`或`中证500`成分股上进行训练。
  - **为新模型命名**: 您可以为训练好的模型起一个自定义的名字，方便后续识别。
- **2. 超参数调节**:
  - 您可以在此处的展开项中，**可视化地调整模型的核心参数**，例如树的数量、学习率等，以探索最佳模型。
- **开始训练**: 点击按钮后，您可以在下方看到一个**实时更新的进度条**，直观地了解训练进度。

### 页面三：投资组合预测

用您训练好的模型来预测未来。

- **选择一个或多个模型进行对比预测**: 本页面支持**多选**。您可以同时选择多个您训练好的模型。
- **选择预测日期**: 选择您想预测哪一天的股票表现。
- **执行对比预测**: 点击按钮，程序会用您选择的所有模型分别进行预测。
- **结果展示**:
  - **多模型预测结果对比**: 一个表格，清晰地列出每支股票以及不同模型给出的预测分数。
  - **Top-10 股票分数对比图**: 一个**分组柱状图**，将表现最好的10支股票并排展示，每个股票下有不同颜色的柱子代表不同模型的打分，对比效果一目了然。

### 页面四：策略回测

检验您的模型和策略到底能不能赚钱。

- **选择一个模型文件进行回测**: 选择您想评估的单个模型。
- **回测参数配置**:
  - **回测时间段**: 选择您想模拟交易的历史时间段。
- **策略参数 (Top-K Dropout)**:
  - **买入Top-K只股票**: 设置每一天，买入模型预测得分最高的K支股票。
  - **持有期(天)**: 设置股票买入后，平均持有N天再根据新信号调仓。
- **交易参数**:
  - **手续费率**: 您可以设置贴近真实交易的开仓、平仓手续费和最低费用。
- **开始回测**: 点击按钮，程序将严格按照您的模型和参数进行模拟，并最终生成一份详细的报告。
- **结果展示**:
  - **绩效指标**: 用卡片展示最重要的四个指标：**年化收益率**、**夏普比率**（衡量风险调整后收益）、**最大回撤**（衡量策略的最大亏损风险）和**换手率**。
  - **资金曲线**: 用折线图展示您的策略相对于基准（如沪深300指数）的收益走势。

希望这份最终版的教程能帮助您顺利地开启量化投资之旅！
