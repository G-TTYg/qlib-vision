# Qlib 可视化工具使用教程

欢迎使用 Qlib 可视化工具！本工具旨在帮助不熟悉编程的用户也能利用 Qlib 强大的量化金融能力。

## 1. 安装与环境配置

在开始之前，请确保您的电脑已经安装了 Python (建议版本 3.9, 3.10, 3.11)。

**步骤一：下载项目文件**

请将我们创建的三个文件下载到您电脑的同一个文件夹中：
- `app.py` (应用主程序)
- `qlib_utils.py` (核心功能库)
- `requirements.txt` (依赖列表)

**步骤二：安装依赖库**

打开您电脑的终端（在 Windows 上是 `Command Prompt` 或 `PowerShell`，在 macOS 或 Linux 上是 `Terminal`），进入您存放项目文件的文件夹，然后运行以下命令：

```bash
pip install -r requirements.txt
```

这个命令会自动下载并安装我们这个工具所需要的所有库。如果网络情况不好，可能需要一些时间，请耐心等待。

## 2. 运行本工具

所有依赖都安装好后，在同一个终端窗口和文件夹下，运行以下命令：

```bash
streamlit run app.py
```

运行后，您的终端会显示一些信息，并且您的默认浏览器会自动打开一个新的网页，地址通常是 `http://localhost:8501`。这个网页就是我们的可视化工具界面！

## 3. 功能页面详解

应用界面左侧是导航栏，您可以在四个功能页面之间切换。

### 页面一：数据管理

这是您需要使用的第一个页面，所有后续操作都依赖于这里下载的数据。

- **Qlib 数据存储路径**：指定下载的数据要保存在您电脑的哪个位置。通常保持默认即可。
- **开始下载/更新A股数据**：点击此按钮，程序会自动从雅虎财经下载A股全市场过去多年的日线数据，并处理成 Qlib 需要的格式。
  - **注意**：首次下载数据量非常大，根据您的网络情况，可能需要**10到30分钟**。您可以在按钮下方的黑色日志框中看到实时的下载进度。
- **检查数据是否存在**：下载完成后，可以点击此按钮，程序会检查指定路径下的数据是否完整、可用。如果显示成功，您就可以进行下一步了。

### 页面二：模型训练

当数据准备好后，您就可以训练自己的AI模型了。

- **选择要训练的模型**：目前支持 `LightGBM` 和 `XGBoost` 两种业界流行的模型。它们都基于 `Alpha158` 因子集进行训练。
- **超参数调节**：这是一个可展开的区域，您可以在这里**可视化地调整模型的核心参数**。
  - **树的数量 (n_estimators)**：通常数量越多，模型可能越准，但训练也越慢。
  - **学习率 (learning_rate)**：控制模型学习速度的参数，通常较小的值（如0.01-0.1）效果更好。
  - **最大深度 (max_depth)**：控制每棵树的复杂度。
- **开始训练**：点击按钮，程序将使用您选择的模型和参数，在历史数据上进行训练。训练完成后，模型文件（`.pkl`）和其配置文件（`.yaml`）会被保存在您指定的“模型保存路径”中。

### 页面三：投资组合预测

训练好模型后，您可以用它来预测未来。

- **模型所在目录**：指定您在第二步中保存模型的文件夹。
- **选择一个模型文件**：程序会自动列出上面目录中所有可用的 `.pkl` 模型，请选择一个。
- **选择预测日期**：选择您想预测哪一天的股票表现。
- **执行预测**：点击按钮，程序会加载模型，并预测出指定日期所有股票的得分（score）。
- **结果展示**：
  - **表格**：以表格形式展示得分最高的N支股票。
  - **图表**：用条形图将Top-N股票的得分可视化，一目了然。

### 页面四：策略回测

这是最关键的一步：用历史数据模拟实盘交易，检验您的模型和策略到底能不能赚钱。

- **选择一个模型文件进行回测**：选择您想评估的模型。
- **回测参数配置**：
  - **开始/结束日期**：选择您想模拟交易的历史时间段。
- **策略参数 (Top-K Dropout)**：
  - **买入Top-K只股票**：设置每一天，我们根据模型预测的得分，买入排名最高的K支股票。
  - **持有期(天)**：设置股票买入后，持有N天再卖出。
- **交易参数**：
  - **手续费率**：您可以设置贴近真实交易的开仓、平仓手续费。
- **开始回测**：点击按钮，激动人心的时刻到来了！程序将严格按照您的模型和参数，在您选择的历史时间段内进行模拟，并最终生成一份详细的报告。
- **结果展示**：
  - **绩效指标**：用卡片展示最重要的四个指标：**年化收益率**、**夏普比率**（衡量风险调整后收益）、**最大回撤**（衡量策略的最大亏损风险）和**换手率**。
  - **资金曲线**：用折线图展示您的策略（蓝色线）相对于基准（如沪深300指数，橙色线）的收益走势。如果您的蓝线远高于橙线，恭喜您！

希望这份教程能帮助您开启量化投资之旅！
